<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Quizz CLF-C02</title>

    <!-- Alpine Plugins -->
    <script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/persist@3.x.x/dist/cdn.min.js"></script>

    <!-- Alpine Core -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <script>
      document.addEventListener('alpine:init', () => {
        Alpine.data('model', () => ({
          questions,
          incorrects: [],
          selectedOpts: Alpine.$persist([]),
          doneIndexes: Alpine.$persist([]),

          init() {
            this.$watch('incorrects', (value) => {
              console.log('The incorrects are: ' + value);
            });
          },

          get correct() {
            return this.questions.length - this.incorrects.length;
          },

          get finished() {
            return this.selectedOpts.length >= this.questions.length;
          },

          get rate() {
            return Math.floor((this.correct / this.questions.length) * 100);
          },

          shuffleNodes(parentElement, tagName) {
            const childrenArray = [...parentElement.children].filter((el) => el.tagName == tagName);
            childrenArray.sort(() => Math.random() - 0.5);
            childrenArray.forEach((child) => parentElement.appendChild(child));
          },

          onSetValue(idx, selectedOpts) {
            if (selectedOpts.length == this.questions[idx].solutions.length) {
              this.selectedOpts[idx] = selectedOpts;

              const isCorrectAnswer = this.questions[idx].solutions.every((el) => selectedOpts.includes(String(el)));
              if (!isCorrectAnswer) this.incorrects.push(idx + 1);
            }
          },

          onRestartForm() {
            this.incorrects = [];

            this.selectedOpts = [];

            document.querySelectorAll('ul[x-data]').forEach((el) => {
              el._x_dataStack[0].val = [];
            });
          },

          onFinish() {
            this.selectedOpts = [...this.selectedOpts, ...Array(this.questions.length - this.selectedOpts.length).fill([])];
          },
        }));
      });
    </script>
  </head>

  <body class="font-sans text-darkslategrey">
    <form x-data="model" class="p-2">
      <button type="button" x-show="!finished" @click="onFinish()" class="bg-green-600 text-white py-1 px-2 rounded">
        SKIP QUIZZ
      </button>

      <button
        type="button"
        x-show="selectedOpts.length > 0"
        @click="onRestartForm()"
        class="bg-green-600 text-white py-1 px-2 rounded"
      >
        RESTART QUIZZ
      </button>

      <progress
        value="0"
        :value="selectedOpts.length"
        :max="questions.length"
        class="w-full h-2 bg-green-200 [&::-webkit-progress-value]:bg-green-600 [&::-moz-progress-bar]:bg-green-600 [&::-webkit-progress-bar]:bg-green-200"
      ></progress>

      <div x-show="finished" class="my-4">
        <b>Correct count:</b> <span x-text="correct"></span><br />
        <b>Incorrect answers:</b> <span x-text="incorrects"></span><br />
        <b>Rate:</b>
        <span x-text="`${rate}% (${rate >= 70 ? 'PASS' : 'FAIL'})`"></span>
        <hr class="my-2" />
      </div>

      <template x-for="(item, index) in questions" :key="index">
        <ul
          x-data="{ val: [] }"
          x-show="index == selectedOpts.length || finished"
          x-transition
          x-init="$nextTick(() => shuffleNodes($el, 'LI'))"
          @change="onSetValue(index, val)"
          class="list-none p-2 mb-2 rounded-lg bg-green-50 ring-2 ring-green-600 ring-inset"
          :class="{ 'min-h-[calc(100lvh_-_5rem)]': !finished }"
        >
          <strong x-text="`Question ${index + 1}:`" class="block text-green-600"></strong>
          <span x-text="item.question"></span>

          <template x-for="(opt, optId) in item.options" :key="optId">
            <li :class="{ 'bg-green-200 ring-1 ring-green-600': item.solutions.includes(optId) && finished }" class="my-1 p-1">
              <input
                type="checkbox"
                :id="`opt-${index}-${optId}`"
                :value="optId"
                :disabled="finished"
                x-model="val"
                class="mr-2"
              />
              <label x-text="opt" :for="`opt-${index}-${optId}`" class="text-sm"></label>
            </li>
          </template>
        </ul>
      </template>
    </form>
  </body>
</html>
<script> questions=[{"index":724,"question":"In the AWS Cloud Adoption Framework, which phase focuses on identifying capability gaps and helping your organization align its readiness for cloud adoption?","options":["Launch","Align","Scale","Envision"],"solutions":[1]},{"index":735,"question":"Under the shared responsibility model, which of the following tasks are the responsibility of the AWS customer? (Select TWO.)","options":["Ensuring that access to data centers is restricted","Ensuring that users have received security training in the use of AWS services","Ensuring that application data is encrypted at rest","Ensuring that AWS NTP servers are set to the correct time","Ensuring that hardware is disposed of properly"],"solutions":[1,2]},{"index":478,"question":"Which cloud architecture design principle is supported by deploying workloads across multiple Availability Zones?","options":["Design for agility.","Design for failure.","Automate infrastructure.","Enable elasticity."],"solutions":[1]}] </script>