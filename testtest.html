<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Quizz CLF-C02</title>

    <!-- Alpine Plugins -->
    <script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/persist@3.x.x/dist/cdn.min.js"></script>

    <!-- Alpine Core -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <script>
      document.addEventListener('alpine:init', () => {
        Alpine.data('model', () => ({
          questions,
          incorrects: [],
          selectedOpts: [[], []],
          doneIndexes: Alpine.$persist([]),

          init() {
            this.$watch('incorrects', (value) => {
              console.log('The incorrects are: ' + value);
            });
          },

          get correct() {
            return this.questions.length - this.incorrects.length;
          },

          get rate() {
            return Math.floor((this.correct / this.questions.length) * 100);
          },

          shuffleNodes(parentElement, tagName) {
            const childrenArray = [...parentElement.children].filter((el) => el.tagName == tagName);
            childrenArray.sort(() => Math.random() - 0.5);
            childrenArray.forEach((child) => parentElement.appendChild(child));
          },

          onSetValue(idx, selectedOpts) {
            if (selectedOpts.length == this.questions[idx].solutions.length) {
              this.selectedOpts[idx] = selectedOpts;

              const isCorrectAnswer = this.questions[idx].solutions.every((el) => selectedOpts.includes(String(el)));
              if (!isCorrectAnswer) this.incorrects.push(idx + 1);
            }
          },

          onRestartForm() {
            this.incorrects = [];

            this.selectedOpts = [];

            document.querySelectorAll('ul[x-data]').forEach((el) => {
              el._x_dataStack[0].val = [];
            });
          },

          onFinish() {
            this.selectedOpts = [...this.selectedOpts, ...Array(this.questions.length - this.selectedOpts.length).fill([])];
          },
        }));
      });
    </script>
  </head>

  <body class="font-sans text-darkslategrey">
    <form x-data="model" class="p-2">
      <template x-for="(item, index) in questions" :key="index">
        <ul class="list-none p-2 mb-2 rounded-lg bg-green-50 ring-2 ring-green-600 ring-inset">
          <template x-for="(opt, optId) in item.options" :key="optId">
            <li class="my-1 p-1">
              <input type="checkbox" :id="`opt-${index}-${optId}`" :value="optId" x-model="selectedOpts[index]" class="mr-2" />
              <label x-text="opt" :for="`opt-${index}-${optId}`" class="text-sm"></label>
            </li>
          </template>
        </ul>
      </template>

      <div>
        <h4>Selected indexes for Set 1:</h4>
        <span x-text="selectedOpts[0]"></span>

        <h4>Selected indexes for Set 2:</h4>
        <span x-text="selectedOpts[1]"></span>
      </div>
    </form>
  </body>
</html>
